"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5627],{2336:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(6540),a=r(5489);function s(){return n.createElement(n.Fragment,null,n.createElement("hr",null),n.createElement("p",{className:"text-md"},"For any questions or to request a tutorial check out our ",n.createElement(a.A,{href:"https://supportportal.thalesgroup.com/community"},n.createElement("span",{className:"text-blue-600"},"community forum")),"."))}},8628:(e,t,r)=>{r.d(t,{A:()=>u});var n=r(6540),a=r(5556),s=r.n(a),o=r(3244),i=r(5489);const c=e=>{let{href:t}=e;return n.createElement("div",null,n.createElement(i.A,{href:t},n.createElement("button",{style:{backgroundColor:"#171515"},className:"p-2 my-4 rounded-md border-none cursor-pointer text-white"},"GitHub ",n.createElement(o.NSh,{className:"text-white"}))))},l=e=>{let{href:t}=e;return n.createElement("div",null,n.createElement(i.A,{href:t},n.createElement("button",{className:"p-2 my-4 rounded-md border-none cursor-pointer"},"View Demo ",n.createElement(o.ifP,null))))},p=e=>{let{href:t,demourl:r}=e;return n.createElement("div",{className:"flex flex-row justify-between"},t?n.createElement(c,{href:t}):n.createElement(n.Fragment,null),r?n.createElement(l,{href:r}):n.createElement(n.Fragment,null))};p.propTypes={href:s().string.isRequired,demourl:s().string};const u=p},6076:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(6540),a=r(5556),s=r.n(a),o=r(8628);const i=e=>{let{embedId:t,github:r,demourl:a}=e;return n.createElement(n.Fragment,null,n.createElement("div",{className:"video-responsive"},n.createElement("iframe",{width:"853",height:"480",src:`https://www.youtube.com/embed/${t}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Embedded youtube"})),n.createElement(o.A,{href:r,demourl:a}))};i.propTypes={embedId:s().string.isRequired};const c=i},3462:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>y,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var n=r(8168),a=(r(6540),r(5680)),s=r(6076),o=(r(8628),r(2336));const i={sidebar_position:1},c="Client Side Object Storage Encryption for S3",l={unversionedId:"key-manager/cs-object-storage",id:"key-manager/cs-object-storage",title:"Client Side Object Storage Encryption for S3",description:"Encrypt your files on the client side before sending them to your S3 buckets with just 3 blocks of code.",source:"@site/docs/key-manager/cs-object-storage.mdx",sourceDirName:"key-manager",slug:"/key-manager/cs-object-storage",permalink:"/ciphertrust/docs/key-manager/cs-object-storage",draft:!1,editUrl:"https://github.com/thalesgroup/ThalesGroup.github.io/tree/main/ciphertrust/docs/key-manager/cs-object-storage.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Key Manager",permalink:"/ciphertrust/docs/category/key-manager"},next:{title:"Encrypt RDS with AWS KMS",permalink:"/ciphertrust/docs/key-manager/aws-kms"}},p={},u=[{value:"Step 1: Authenticate with CipherTrust Manager",id:"step-1-authenticate-with-ciphertrust-manager",level:2},{value:"Step 2: Encrypt Data using CipherTrust Manager API",id:"step-2-encrypt-data-using-ciphertrust-manager-api",level:2},{value:"Step 3: Decrypt Data",id:"step-3-decrypt-data",level:2}],d={toc:u},m="wrapper";function y(e){let{components:t,...r}=e;return(0,a.yg)(m,(0,n.A)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"client-side-object-storage-encryption-for-s3"},"Client Side Object Storage Encryption for S3"),(0,a.yg)("p",null,"Encrypt your files on the client side before sending them to your S3 buckets with just 3 blocks of code."),(0,a.yg)(s.A,{embedId:"fI0qZB5YB5g",github:"https://github.com/ThalesGroup/learn-ciphertrust/tree/main/learn/key-management/object-storage-encryption-demo",demourl:"https://moral-fox.sneakpeak.dev",mdxType:"YoutubeEmbed"}),(0,a.yg)("h2",{id:"step-1-authenticate-with-ciphertrust-manager"},"Step 1: Authenticate with CipherTrust Manager"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-jsx",metastring:'title="/api/get-jwt.js"',title:'"/api/get-jwt.js"'},"// `createJWT` is a helper function that creates a JWT.\n// This function must only called on the server. \n// If you call it on the client-side you will expose your username and password in every request. DO NOT DO THIS. Just use it in a server-side API call.\nasync function createJWT() {\n    const response = await axios.post(\n        `${process.env.CTM_URL}/api/v1/auth/tokens`,\n        {\n            username: process.env.CTM_USERNAME,        // Add CipherTrust manager username to environment\n            password: process.env.CTM_PASSWORD,        // Add CipherTrust manager password to environment\n        }\n    ).catch(err => {\n        console.error(err);\n        // res.status(502).send(err.toString());\n    });\n\n    const token = response.data.jwt;\n\n    return token\n}\n")),(0,a.yg)("admonition",{type:"info"},(0,a.yg)("p",{parentName:"admonition"},"Remember to replace ",(0,a.yg)("inlineCode",{parentName:"p"},"process.env.CTM_USERNAME")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"process.env.CTM_PASSWORD")," with your CipherTrust Manager username and password.")),(0,a.yg)("h2",{id:"step-2-encrypt-data-using-ciphertrust-manager-api"},"Step 2: Encrypt Data using CipherTrust Manager API"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-jsx",metastring:'title="/api/encrypt.js"',title:'"/api/encrypt.js"'},'async function encryptData(file, jwt) {\n    const fileBase64 = (await getBase64(file)).split(",")[1];\n    const cipherText = await axios.post(\n        // We are using an encrypt proxy because calling the API from the browser will cause a CORS error. The encrypt proxy will point your API request to the Ciphertrust manager Crypto API.\n        `/api/encrypt-proxy`, {\n            id: "s3-encrypt-symmetric-key",\n            plaintext: fileBase64,\n            add: "YXV0aGVudGljYXRl"\n        }, {\n            // Pass the JWT as a Bearer token.\n            headers: {\n                Authorization: `Bearer ${jwt}`\n            }\n        }).catch(err => {\n            console.error(err);\n            res.status(502).send(err.toString());\n        });\n\n    return cipherText.data;\n}\n')),(0,a.yg)("p",null,(0,a.yg)("em",{parentName:"p"},"Now you can upload this cipher text to AWS S3, Azure Blob Storage or any other object storage.")),(0,a.yg)("h2",{id:"step-3-decrypt-data"},"Step 3: Decrypt Data"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-jsx",metastring:'title="/api/decrypt.js"',title:'"/api/decrypt.js"'},'async function decryptData(encryptedData, jwt) {\n    const plainText = await axios.post(\n        `/api/decrypt-proxy`, {\n            ...encryptedData,\n            add: "YXV0aGVudGljYXRl"\n        }, {\n            // Pass the JWT as a Bearer token.\n            headers: {\n                Authorization: `Bearer ${jwt}`\n            }\n        }).catch(err => {\n            console.error(err);\n        });\n\n\n    return plainText.data;\n}\n')),(0,a.yg)(o.A,{mdxType:"TutorialFooter"}))}y.isMDXComponent=!0}}]);